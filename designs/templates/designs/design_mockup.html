{% extends 'base.html' %}
{% load static %}

{% block page_header %}
<div class="container header-container">
    <div class="row">
        <div class="col"></div>
    </div>
</div>
{% endblock %}

{% block content %}
    <div class="overlay"></div>

    <!-- Create the container of the tool -->
    <div id="tshirt-div">
        <!-- 
                Initially, the image will have the background tshirt that has transparency
                So we can simply update the color with CSS or JavaScript dinamically
            -->
        <img id="tshirt-backgroundpicture" src="{{ MEDIA_URL }}/background_tshirt.png" />

        <div id="drawingArea" class="drawing-area">
            <div class="canvas-container">
                <canvas id="tshirt-canvas" width="200" height="400"></canvas>
            </div>
        </div>
    </div>

    <p>To remove a loaded picture on the T-Shirt select it and press the <kbd>DEL</kbd> key.</p>
    <!-- The select that will allow the user to pick one of the static designs -->
    <br>
    <!-- The select that will allow the user to pick one of the static designs -->
    <br>
    <label for="tshirt-design">T-Shirt Design:</label>
    <select id="tshirt-design">
        <option value="">Select one of our designs ...</option>
        <option value="{{ MEDIA_URL }}/batman.png">Batman</option>
    </select>

    <!-- The Select that allows the user to change the color of the T-Shirt -->
    <br><br>
    <label for="tshirt-color">T-Shirt Color:</label>
    <select id="tshirt-color">
        <!-- You can add any color with a new option and definings its hex code -->
        <option value="#fff">White</option>
        <option value="#000">Black</option>
        <option value="#f00">Red</option>
        <option value="#008000">Green</option>
        <option value="#ff0">Yellow</option>
    </select>

{% endblock %}

{% block postloadjs %}
    <!-- Include Fabric.js in the page -->
    <script src="{{ STATIC_URL }}js/fabric.min.js"></script>
    <script>
        // Select the canvas an make it accesible for all the snippets of this article
        let canvas = new fabric.Canvas('tshirt-canvas');

        /**
        * Method that defines a picture as background image of the canvas.
        * 
        * @param {String} imageUrl      The server URL of the image that you want to load on the T-Shirt.
        *
        * @return {void} Return value description.
        */
        function updateTshirtImage(imageURL) {
            // If the user doesn't pick an option of the select, clear the canvas
            if (!imageURL) {
                canvas.clear();
            }

            // Create a new image that can be used in Fabric with the URL
            fabric.Image.fromURL(imageURL, function (img) {
                // Define the image as background image of the Canvas
                canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), {
                    // Scale the image to the canvas size
                    scaleX: canvas.width / img.width,
                    scaleY: canvas.height / img.height
                });
            });
        }

        // 1. When the T-Shirt color select changes:
        // Update the TShirt color according to the selected color by the user
        document.getElementById("tshirt-color").addEventListener("change", function () {
            document.getElementById("tshirt-div").style.backgroundColor = this.value;
        }, false);

        // 2. When the user picks a design:
        // Update the TShirt background image according to the selected image by the user
        document.getElementById("tshirt-design").addEventListener("change", function () {

            // Call the updateTshirtImage method providing as first argument the URL
            // of the image provided by the select
            updateTshirtImage(this.value);
        }, false);
    </script>

{% endblock %}